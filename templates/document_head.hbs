<meta content="width=device-width, initial-scale=1.0" name="viewport" />
<!-- Google Tag Manager -->
<script>(function (w, d, s, l, i) {
        w[l] = w[l] || []; w[l].push({
            'gtm.start':
                new Date().getTime(), event: 'gtm.js'
        }); var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-M33KPWQ');</script>
<!-- End Google Tag Manager -->
{{#if settings.enable_headroom}}
<script src="{{asset 'headroom.min.js'}}"></script>
{{/if}}

<script>
    // housekeeping
    function getAccessToken() {
        var b = document.cookie.match('(^|;)\\s*' + "access_token" + '\\s*=\\s*([^;]+)');
        return b ? b.pop() : null;
    }

    if (window.sessionStorage.getItem("last_access_token") === null && getAccessToken() !== null) {
        window.sessionStorage.setItem("last_access_token", getAccessToken());
    }

    if (window.sessionStorage.getItem("last_access_token") !== getAccessToken()) {
        window.sessionStorage.removeItem("sso_checked");
        window.sessionStorage.removeItem("phone_reg");
        window.sessionStorage.setItem("last_access_token", getAccessToken());
    }
</script>

{{#unless signed_in}}
<script type="text/javascript">

    function getAccessToken() {
        var b = document.cookie.match('(^|;)\\s*' + "access_token" + '\\s*=\\s*([^;]+)');
        return b ? b.pop() : '';
    }

    // housekeeping
    if (window.sessionStorage.getItem("last_access_token") !== getAccessToken()) {
        window.sessionStorage.removeItem("sso_checked");
        window.sessionStorage.removeItem("phone_reg");
    } else {
        window.sessionStorage.setItem("last_access_token", getAccessToken());
    }

    // user authenticated on BU with email account
    if (
        document.cookie.match(/^(.*;)?\s*access_token\s*=\s*[^;]+(.*)?$/) !==
        null && sessionStorage.getItem("sso_checked") === null
    ) {
        window.sessionStorage.setItem("sso_checked", true);
        window.location = "{{settings.country_site_url}}" + "account/zendesksso/?nativeMode=1"
    }
    // user authenticated on BU with phone account
    if (document.cookie.match(/^(.*;)?\s*access_token\s*=\s*[^;]+(.*)?$/) !==
        null && sessionStorage.getItem("sso_checked") !== null) {
        console.log("PHONE REGISTRATION DETECTED");
        window.sessionStorage.setItem("phone_reg", true);
    }
    // user signed-out on BU
    if (document.cookie.match(/^(.*;)?\s*access_token\s*=\s*[^;]+(.*)?$/) === null) {
        window.sessionStorage.removeItem("sso_checked");
        window.sessionStorage.removeItem("phone_reg");
    }
</script>
{{/unless}}
